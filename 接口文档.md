请查看并更新接口文档.md文件，包含本次开发的新接口：
1. 后端API：新增/修改的端点、参数和返回格式
2. 前端组件：新创建组件的props、events和使用方法
3. 数据模型：新增/修改的实体结构和关系
4. 地图交互：新增地图功能和数据格式

保持文档格式统一，使用markdown表格或代码块展示接口细节。

## 前端组件

### HomeView
```vue
主页面组件，目前为基础结构
<template>
  <div class="home">
    <h1>武汉美食地图</h1>
    <p>欢迎使用武汉美食地图系统</p>
    <div class="actions">
      <router-link to="/map" class="map-btn">查看地图</router-link>
    </div>
  </div>
</template>
```

### MapView
```vue
地图页面组件，集成MapContainer和FilterPanel
<template>
  <div class="map-view">
    <div class="header">
      <h1>武汉美食地图</h1>
      <p>探索武汉特色美食地点</p>
    </div>
    <div class="filter-container">
      <FilterPanel />
    </div>
    <div class="map-container-wrapper">
      <MapContainer />
    </div>
  </div>
</template>
```

### MapContainer
```vue
地图容器组件，负责渲染和控制Mapbox地图
<template>
  <div>
    <div id="map" class="map-container"></div>
    <div class="map-controls">
      <button @click="zoomIn" class="map-control-btn">+</button>
      <button @click="zoomOut" class="map-control-btn">-</button>
      <button @click="resetView" class="map-control-btn">⟳</button>
    </div>
    <!-- 餐厅详情面板 -->
    <div v-if="selectedRestaurant" class="restaurant-panel">
      <RestaurantInfo 
        :restaurant="selectedRestaurant" 
        @close="closeRestaurantInfo" 
      />
    </div>
  </div>
</template>
```

**属性与方法**
| 名称 | 类型 | 描述 |
|------|------|------|
| mapInstance | ref | 地图实例引用 |
| initialCenter | Array | 初始地图中心点坐标 [经度, 纬度] |
| initialZoom | Number | 初始缩放级别 |
| filteredRestaurants | ref | 当前筛选后的餐厅数据 |
| selectedRestaurant | ref | 当前选中的餐厅 |
| isLoading | ref | 加载状态标志 |
| error | ref | 错误信息 |
| markers | ref | 餐厅标记集合 |
| zoomIn() | Function | 放大地图 |
| zoomOut() | Function | 缩小地图 |
| resetView() | Function | 重置地图视图到初始状态 |
| fetchRestaurants() | Function | 获取所有餐厅数据 |
| showRestaurantDetails(id) | Function | 显示餐厅详情 |
| closeRestaurantInfo() | Function | 关闭餐厅详情 |

### FilterPanel
```vue
筛选面板组件，提供筛选和搜索功能
<template>
  <div class="filter-panel">
    <div class="search-container">
      <input
        type="text"
        v-model="searchQuery"
        placeholder="搜索餐厅名称..."
        class="search-input"
        @input="handleSearch"
      />
      <button class="search-btn" @click="handleSearch">
        <span>🔍</span>
      </button>
    </div>
    
    <div class="filter-container">
      <div class="filter-group">
        <h4>区域筛选</h4>
        <select v-model="selectedDistrict" class="filter-select" @change="applyFilters">
          <option value="">所有区域</option>
          <option v-for="district in districtList" :key="district" :value="district">
            {{ district }}
          </option>
        </select>
      </div>
      
      <div class="filter-group">
        <h4>美食类型</h4>
        <select v-model="selectedFoodType" class="filter-select" @change="applyFilters">
          <option value="">所有类型</option>
          <option v-for="foodType in foodTypeList" :key="foodType" :value="foodType">
            {{ foodType }}
          </option>
        </select>
      </div>
    </div>
    
    <div class="filter-actions">
      <button class="reset-btn" @click="resetFilters">重置筛选</button>
    </div>
  </div>
</template>
```

**属性与方法**
| 名称 | 类型 | 描述 |
|------|------|------|
| searchQuery | ref | 搜索关键词 |
| selectedDistrict | ref | 当前选中的区域 |
| selectedFoodType | ref | 当前选中的美食类型 |
| districtList | computed | 区域列表 |
| foodTypeList | computed | 美食类型列表 |
| handleSearch() | Function | 处理搜索操作 |
| applyFilters() | Function | 应用筛选条件 |
| resetFilters() | Function | 重置所有筛选条件 |

### RestaurantInfo
```vue
餐厅详情组件，显示餐厅详细信息
<template>
  <div class="restaurant-info">
    <div class="info-header">
      <h3>{{ restaurant.name }}</h3>
      <button class="close-btn" @click="$emit('close')">&times;</button>
    </div>
    
    <div v-if="restaurant.image_url" class="info-image">
      <img :src="restaurant.image_url" :alt="restaurant.name">
    </div>
    
    <div class="info-content">
      <div v-if="reviewData" class="rating-summary">
        <RatingStars :model-value="reviewData.avg_rating" />
        <span class="rating-text">{{ reviewData.avg_rating.toFixed(1) }} ({{ reviewData.review_count }})</span>
      </div>
      <!-- 其他餐厅信息 -->
    </div>
    
    <!-- 用户评价区域 -->
    <div class="info-reviews">
      <div class="section-heading">
        <h4>用户评价</h4>
        <button v-if="!showReviewForm" class="add-review-btn" @click="showReviewForm = true">
          写评价
        </button>
      </div>
      
      <ReviewForm 
        v-if="showReviewForm" 
        :restaurant-id="restaurant.id" 
        :on-success="handleReviewSubmit"
      />
      
      <ReviewList 
        :reviews="reviews" 
        :avg-rating="reviewData?.avg_rating || 0" 
        :review-count="reviewData?.review_count || 0"
        :loading="isLoading" 
        :error="error"
      />
    </div>
  </div>
</template>
```

**属性与事件**
| 名称 | 类型 | 描述 |
|------|------|------|
| restaurant | Object (prop) | 餐厅详情对象，必须提供 |
| reviews | ref | 餐厅的用户评价列表 |
| reviewData | ref | 评价统计数据（平均分、评价数量） |
| isLoading | ref | 评价加载状态 |
| error | ref | 评价加载错误信息 |
| showReviewForm | ref | 是否显示评价表单 |
| fetchReviews() | Function | 获取餐厅评价数据 |
| handleReviewSubmit() | Function | 处理评价提交 |
| close | Event | 关闭详情面板事件 |

### RestaurantMarker
```vue
餐厅标记组件，用于显示餐厅在地图上的位置
<template>
  <div class="marker-container">
    <div 
      class="map-marker"
      :class="{ 'active': isActive }"
      @click="handleMarkerClick"
    >
      <span class="icon">🍜</span>
    </div>
  </div>
</template>
```

**属性与事件**
| 名称 | 类型 | 描述 |
|------|------|------|
| restaurant | Object (prop) | 餐厅对象，必须提供 |
| isActive | Boolean (prop) | 是否处于选中状态 |
| click | Event | 点击标记事件，返回餐厅对象 |

### RatingStars
```vue
评分星级组件，用于显示和选择评分
<template>
  <div class="rating-stars">
    <div class="stars-container">
      <span 
        v-for="star in 5" 
        :key="star"
        class="star"
        :class="{
          'filled': (modelValue >= star || tempRating >= star),
          'interactive': interactive
        }"
        @click="interactive && updateRating(star)"
        @mouseover="interactive && setTempRating(star)"
        @mouseleave="interactive && resetTempRating()"
      >
        ★
      </span>
    </div>
    <span v-if="showValue" class="rating-value">{{ modelValue || tempRating || 0 }}/5</span>
  </div>
</template>
```

**属性与方法**
| 名称 | 类型 | 描述 |
|------|------|------|
| modelValue | Number (prop) | 当前评分值 (v-model绑定) |
| interactive | Boolean (prop) | 是否允许交互 |
| showValue | Boolean (prop) | 是否显示评分数值 |
| tempRating | ref | 临时评分值（悬停状态） |
| updateRating() | Function | 更新评分值 |
| setTempRating() | Function | 设置临时评分值 |
| resetTempRating() | Function | 重置临时评分值 |
| update:modelValue | Event | 更新v-model绑定值 |

### ReviewList
```vue
评论列表组件，显示餐厅评价列表
<template>
  <div class="review-list">
    <div v-if="loading" class="loading">
      加载评价中...
    </div>
    
    <div v-else-if="error" class="error">
      {{ error }}
    </div>
    
    <div v-else-if="reviews.length === 0" class="no-reviews">
      还没有评价，快来添加第一条评价吧！
    </div>
    
    <div v-else>
      <div class="review-summary">
        <div class="avg-rating">
          <span class="rating-value">{{ avgRating }}</span>
          <RatingStars :model-value="avgRating" />
        </div>
        <span class="review-count">共 {{ reviewCount }} 条评价</span>
      </div>
      
      <div class="review-items">
        <div v-for="review in reviews" :key="review.id" class="review-item">
          <div class="review-header">
            <span class="user-name">{{ review.user_name || '匿名用户' }}</span>
            <div class="review-rating">
              <RatingStars :model-value="review.rating" />
            </div>
          </div>
          
          <div class="review-content">
            {{ review.comment || '该用户未填写评价内容' }}
          </div>
          
          <div class="review-time">
            {{ formatDate(review.created_at) }}
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
```

**属性与方法**
| 名称 | 类型 | 描述 |
|------|------|------|
| reviews | Array (prop) | 评价列表数据 |
| avgRating | Number (prop) | 平均评分 |
| reviewCount | Number (prop) | 评价总数 |
| loading | Boolean (prop) | 加载状态 |
| error | String (prop) | 错误信息 |
| formatDate() | Function | 格式化日期 |

### ReviewForm
```vue
评论提交表单组件，用于提交用户评价
<template>
  <div class="review-form">
    <h4>添加您的评价</h4>
    
    <div class="form-group">
      <label>您的评分:</label>
      <RatingStars 
        v-model="rating" 
        :interactive="true" 
        :show-value="true" 
      />
    </div>
    
    <div class="form-group">
      <label for="user-name">您的名字 (可选):</label>
      <input 
        type="text" 
        id="user-name" 
        v-model="userName" 
        placeholder="请输入您的名字"
        class="form-input"
      />
    </div>
    
    <div class="form-group">
      <label for="comment">评价内容 (可选):</label>
      <textarea 
        id="comment" 
        v-model="comment" 
        placeholder="分享您的用餐体验..."
        class="form-textarea"
        rows="3"
      ></textarea>
    </div>
    
    <div class="form-actions">
      <button 
        @click="submitReview" 
        :disabled="!isValid || isSubmitting"
        class="submit-btn"
      >
        {{ isSubmitting ? '提交中...' : '提交评价' }}
      </button>
      <div v-if="error" class="error-message">{{ error }}</div>
    </div>
  </div>
</template>
```

**属性与方法**
| 名称 | 类型 | 描述 |
|------|------|------|
| restaurantId | Number (prop) | 餐厅ID |
| onSuccess | Function (prop) | 评价提交成功回调 |
| rating | ref | 当前评分值 |
| userName | ref | 用户名 |
| comment | ref | 评价内容 |
| isSubmitting | ref | 提交状态 |
| error | ref | 错误信息 |
| isValid | computed | 表单是否有效 |
| submitReview() | Function | 提交评价 |

## 后端API

### 获取餐厅列表

```
GET /api/restaurants/
```

**查询参数**
- `district`: (可选) 按区域筛选
- `food_type`: (可选) 按美食类型筛选
- `query`: (可选) 按名称或描述搜索

**响应**
```json
[
  {
    "id": 1,
    "name": "黄鹤楼小吃店",
    "address": "武汉市武昌区蛇山西山坡特1号",
    "latitude": 30.5433,
    "longitude": 114.3008,
    "food_type": "湖北菜",
    "district": "武昌区",
    "image_url": "http://example.com/image1.jpg"
  },
  {
    // 其他餐厅...
  }
]
```

### 获取餐厅详情

```
GET /api/restaurants/<id>
```

**路径参数**
- `id`: 餐厅ID

**响应**
```json
{
  "id": 1,
  "name": "黄鹤楼小吃店",
  "address": "武汉市武昌区蛇山西山坡特1号",
  "latitude": 30.5433,
  "longitude": 114.3008,
  "phone": "027-88888888",
  "food_type": "湖北菜",
  "description": "以热干面、豆皮等武汉特色小吃为主",
  "image_url": "http://example.com/image1.jpg",
  "business_hours": "周一至周日 9:00-22:00",
  "district": "武昌区"
}
```

### 获取区域列表

```
GET /api/restaurants/districts
```

**响应**
```json
[
  "武昌区",
  "汉阳区",
  "江汉区",
  "江岸区",
  "硚口区",
  "洪山区"
]
```

### 获取美食类型列表

```
GET /api/restaurants/food-types
```

**响应**
```json
[
  "湖北菜",
  "川菜",
  "粤菜",
  "西餐",
  "小吃",
  "烧烤"
]
```

### 获取附近餐厅

```
GET /api/restaurants/nearby
```

**查询参数**
- `lat`: (必须) 纬度
- `lng`: (必须) 经度
- `distance`: (可选) 半径范围，单位为公里，默认为2

**响应**
```json
[
  {
    "id": 1,
    "name": "黄鹤楼小吃店",
    "address": "武汉市武昌区蛇山西山坡特1号",
    "latitude": 30.5433,
    "longitude": 114.3008,
    "food_type": "湖北菜",
    "district": "武昌区",
    "distance_km": 0.25,
    "image_url": "http://example.com/image1.jpg"
  },
  {
    // 其他附近餐厅...
  }
]
```

### 获取区域内餐厅

```
GET /api/restaurants/bbox
```

**查询参数**
- `min_lat`: (必须) 最小纬度
- `min_lng`: (必须) 最小经度
- `max_lat`: (必须) 最大纬度
- `max_lng`: (必须) 最大经度

**响应**
```json
[
  {
    "id": 1,
    "name": "黄鹤楼小吃店",
    "address": "武汉市武昌区蛇山西山坡特1号",
    "latitude": 30.5433,
    "longitude": 114.3008,
    "food_type": "湖北菜",
    "district": "武昌区",
    "image_url": "http://example.com/image1.jpg"
  },
  {
    // 区域内其他餐厅...
  }
]
```

### 按区域统计餐厅

```
GET /api/restaurants/stats/by-district
```

**响应**
```json
[
  {
    "district": "武昌区",
    "count": 3
  },
  {
    "district": "洪山区",
    "count": 2
  },
  // 其他区域统计...
]
```

### 按美食类型统计餐厅

```
GET /api/restaurants/stats/by-food-type
```

**响应**
```json
[
  {
    "food_type": "湖北菜",
    "count": 2
  },
  {
    "food_type": "烧烤",
    "count": 1
  },
  // 其他类型统计...
]
```

### 获取餐厅评价

```
GET /api/restaurants/<restaurant_id>/reviews
```

**路径参数**
- `restaurant_id`: 餐厅ID

**响应**
```json
{
  "reviews": [
    {
      "id": 1,
      "restaurant_id": 1,
      "rating": 5,
      "comment": "味道很好，环境也不错。",
      "user_name": "武汉吃货",
      "created_at": "2023-04-20T14:30:45"
    },
    {
      "id": 2,
      "restaurant_id": 1,
      "rating": 4,
      "comment": "分量足，价格实惠。",
      "user_name": "美食探险家",
      "created_at": "2023-04-19T10:15:22"
    }
  ],
  "avg_rating": 4.5,
  "review_count": 2
}
```

### 提交餐厅评价

```
POST /api/restaurants/<restaurant_id>/reviews
```

**路径参数**
- `restaurant_id`: 餐厅ID

**请求体**
```json
{
  "rating": 5,
  "comment": "味道很好，环境也不错。",
  "user_name": "武汉吃货"
}
```

**响应**
```json
{
  "id": 3,
  "restaurant_id": 1,
  "rating": 5,
  "comment": "味道很好，环境也不错。",
  "user_name": "武汉吃货",
  "created_at": "2023-04-22T09:45:12"
}
```

## 数据模型

### Restaurant 餐厅

| 字段 | 类型 | 必填 | 描述 |
|------|------|------|------|
| id | Integer | 是 | 主键 |
| name | String(100) | 是 | 餐厅名称 |
| address | String(200) | 是 | 地址 |
| latitude | Float | 是 | 纬度 |
| longitude | Float | 是 | 经度 |
| location | Geometry(Point,4326) | 自动 | 地理位置点 |
| phone | String(20) | 否 | 联系电话 |
| food_type | String(50) | 否 | 美食类型 |
| description | Text | 否 | 描述 |
| image_url | String(255) | 否 | 图片链接 |
| business_hours | String(200) | 否 | 营业时间 |
| district | String(50) | 否 | 所在区域 |
| created_at | DateTime | 自动 | 创建时间 |
| updated_at | DateTime | 自动 | 更新时间 |

### Review 评价

| 字段 | 类型 | 必填 | 描述 |
|------|------|------|------|
| id | Integer | 是 | 主键 |
| restaurant_id | Integer | 是 | 关联餐厅ID(外键) |
| rating | Integer | 是 | 评分(1-5) |
| comment | Text | 否 | 评价内容 |
| user_name | String(50) | 否 | 用户名 |
| created_at | DateTime | 自动 | 创建时间 |

## 前端服务

### API服务

**文件路径**: `src/services/api.js`

| 函数名 | 参数 | 返回值 | 描述 |
|------|------|------|------|
| getRestaurants | filters: Object | Promise<Array> | 获取餐厅列表，可选筛选参数 |
| getRestaurantById | id: Number | Promise<Object> | 获取指定ID的餐厅详情 |
| getDistricts | 无 | Promise<Array> | 获取所有区域列表 |
| getFoodTypes | 无 | Promise<Array> | 获取所有美食类型列表 |
| getNearbyRestaurants | lat: Number, lng: Number, distance: Number | Promise<Array> | 获取指定坐标附近的餐厅 |
| getRestaurantsInBoundingBox | minLat: Number, minLng: Number, maxLat: Number, maxLng: Number | Promise<Array> | 获取指定矩形区域内的餐厅 |
| getRestaurantStatsByDistrict | 无 | Promise<Array> | 获取按区域统计的餐厅数量 |
| getRestaurantStatsByFoodType | 无 | Promise<Array> | 获取按美食类型统计的餐厅数量 |
| getRestaurantReviews | restaurantId: Number | Promise<Object> | 获取指定餐厅的评价列表和统计信息 |
| addRestaurantReview | restaurantId: Number, reviewData: Object | Promise<Object> | 提交餐厅评价 |

## 状态管理

### 餐厅Store

**文件路径**: `src/stores/restaurant.js`

**状态**
| 名称 | 类型 | 描述 |
|------|------|------|
| restaurants | Array | 所有餐厅数据 |
| filteredRestaurants | Array | 筛选后的餐厅数据 |
| selectedRestaurant | Object | 当前选中的餐厅 |
| loading | Boolean | 加载状态 |
| error | String | 错误信息 |
| filters | Object | 当前筛选条件 |
| districtList | Array | 区域列表 |
| foodTypeList | Array | 美食类型列表 |
| nearbyRestaurants | Array | 附近餐厅列表 |
| userLocation | Object | 用户当前位置 |

**Getters**
| 名称 | 参数 | 返回值 | 描述 |
|------|------|------|------|
| getRestaurantById | id: Number | Object | 获取指定ID的餐厅 |
| getRestaurantsByDistrict | district: String | Array | 按区域筛选餐厅 |
| getRestaurantsByFoodType | foodType: String | Array | 按美食类型筛选餐厅 |
| getDistrictList | - | Array | 获取所有区域列表 |
| getFoodTypeList | - | Array | 获取所有美食类型列表 |
| getNearbyRestaurants | distance: Number | Array | 获取用户附近指定距离内的餐厅 |

**Actions**
| 名称 | 参数 | 描述 |
|------|------|------|
| fetchRestaurants | - | 获取所有餐厅数据 |
| fetchRestaurantDetails | id: Number | 获取指定ID的餐厅详情 |
| fetchDistrictList | - | 获取所有区域列表 |
| fetchFoodTypeList | - | 获取所有美食类型列表 |
| applyFilters | filterOptions: Object | 应用筛选条件 |
| resetFilters | - | 重置所有筛选条件 |
| clearSelectedRestaurant | - | 清除选中的餐厅 |
| fetchNearbyRestaurants | lat: Number, lng: Number, distance: Number | 获取指定坐标附近的餐厅 |
| setUserLocation | lat: Number, lng: Number | 设置用户当前位置 |
| fetchRestaurantsInBoundingBox | bounds: Object | 获取地图可视区域内的餐厅 |

## 路由配置

| 路径 | 名称 | 组件 | 描述 |
|------|------|------|------|
| `/` | home | HomeView | 应用主页 |
| `/map` | map | MapView | 地图页面 |

## 项目结构

```
src/
├── assets/       # 静态资源文件
│   ├── components/   
│   │   ├── FilterPanel.vue    # 筛选面板组件
│   │   ├── HelloWorld.vue     # 示例组件
│   │   ├── MapContainer.vue   # 地图容器组件
│   │   ├── RatingStars.vue    # 评分星级组件
│   │   ├── RestaurantInfo.vue # 餐厅详情组件
│   │   ├── RestaurantMarker.vue # 餐厅标记组件
│   │   ├── ReviewForm.vue     # 评价提交表单组件
│   │   └── ReviewList.vue     # 评价列表组件
│   ├── router/       # 路由配置
│   ├── services/     # API服务
│   │   └── api.js    # 餐厅数据API
│   ├── stores/       # Pinia状态管理
│   │   └── restaurant.js # 餐厅数据状态
│   ├── views/        
│   │   ├── HomeView.vue      # 首页组件
│   │   └── MapView.vue       # 地图页面组件
│   ├── App.vue       # 根组件
│   ├── main.js       # 应用入口
│   └── style.css     # 全局样式

backend/
├── app/                    # 应用主目录
│   ├── models/             # 数据模型
│   │   ├── restaurant.py   # 餐厅模型
│   │   └── review.py       # 评价模型
│   ├── routes/             # API路由
│   │   └── restaurants.py  # 餐厅API路由
│   ├── schemas/            # 数据验证模式
│   └── geo_helper.py       # 地理空间查询辅助模块
├── config/                 # 配置目录
├── tests/                  # 测试目录
├── .env                    # 环境变量
├── run.py                  # 应用入口文件
├── seed_data.py            # 测试数据脚本
├── update_seed_data.py     # 更新测试数据脚本(含评价数据)
├── init_db.py              # 数据表创建脚本
├── setup_database.py       # 数据库创建脚本
├── migrations.py           # 数据库迁移脚本
├── geo_query_examples.py   # 地理空间查询示例
├── DATABASE_SETUP.md       # 数据库设置文档
└── DATABASE_INSTALL_GUIDE.md # 数据库安装指南
```

## 地图交互功能

| 功能 | 描述 |
|------|------|
| 显示餐厅标记 | 在地图上以标记形式显示餐厅位置 |
| 点击标记查看详情 | 点击餐厅标记后，显示该餐厅的详细信息 |
| 地图缩放控制 | 通过按钮控制地图的放大和缩小 |
| 重置视图 | 恢复地图到初始视图状态 |
| 标记高亮 | 选中的餐厅标记会高亮显示 |
| 筛选餐厅 | 根据区域或美食类型筛选餐厅显示 |
| 搜索餐厅 | 根据餐厅名称或描述搜索 |
| 附近餐厅查询 | 查询用户当前位置附近的餐厅 |
| 区域内餐厅查询 | 查询地图可视区域内的餐厅 |
| 距离排序 | 根据与当前位置的距离排序餐厅 |
| 地理统计 | 展示各区域餐厅分布数量 |
| 用户评价 | 显示餐厅的用户评价信息 |
| 提交评价 | 允许用户为餐厅提交评分和评价 |

## 空间数据格式

### GeoJSON

地理位置数据以GeoJSON格式返回：

```json
{
  "type": "Point",
  "coordinates": [114.3008, 30.5433]
}
```

坐标系统使用WGS84 (EPSG:4326)，与Mapbox GL JS兼容。